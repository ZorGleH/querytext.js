var querytext=function(n){var t=function(a){return a.replace(/\u00c6/gm,"AE").replace(/[\u00c1\u00c2\u00c0\u00c5\u00c3\u00c4]/gm,"A").replace(/\u00c7/gm,"C").replace(/[\u00c9\u00ca\u00c8\u00cb]/gm,"E").replace(/[\u00cd\u00ce\u00cc\u00cf]/gm,"I").replace(/\u00d1/gm,"N").replace(/\u0152/gm,"OE").replace(/[\u00d3\u00d4\u00d2\u00d8\u00d5\u00d6]/gm,"O").replace(/[\u00da\u00db\u00d9\u00dc]/gm,"U").replace(/\u00dd/gm,"Y").replace(/\u00e6/gm,"ae").replace(/[\u00e1\u00e2\u00e0\u00e5\u00e3\u00e4]/gm,"a").replace(/\u00e7/gm,"c").replace(/[\u00e9\u00ea\u00e8\u00eb]/gm,"e").replace(/[\u00ed\u00ee\u00ec\u00ef]/gm,"i").replace(/\u00f1/gm,"n").replace(/\u0153/gm,"oe").replace(/[\u00f3\u00f4\u00f2\u00f8\u00f5\u00f6]/gm,"o").replace(/[\u00fa\u00fb\u00f9\u00fc]/gm,"u").replace(/[\u00fd\u00ff]/gm,"y")},u=function(a,e,d,c){var f,b=[];for(f in a)a[f].forEach(function(a){b.push([a,f.length])});b.sort(function(b,a){return a[0]>b[0]}).forEach(function(b){e=e.substr(0,b[0])+d+e.substr(b[0],b[1])+c+e.substr(b[0]+b[1])});return e},r=
{VERSION:0.5,opts:{dftbool:"OR",sensitive:!1,wholeword:!0,unaccent:!0,matches:!1,debug:!1},error:!1,query:!1,tree:!1,parse:function(a){var e=function(a,c,f){c||(c=0);for(var b=0,m=!1,h=!1,k=a.length,g,s,p,l,n,q,r=function(a,b){m&&(a.not=!0,h||(h="AND"),m=!1);if(a.text){var c=a.text.replace(/(^\s+|\s+$)/gm,""),e="*"!=c[0]&&f.wholeword?"(^|\\W:?)":"",g="*"!=c.substr(-1)&&f.wholeword?"($|\\W:?)":"",c=c.replace(/(^\*|\*$)/g,""),c=c.replace(/([\(\)\+\*\?\:\[\]])/g,"\\$1"),c=c.replace(/\s+/g,"\\s+");a.rex=
RegExp(e+c+g,"m"+(f.sensitive?"":"i")+(f.matches?"g":""))}b&&(a.src=b);q?(h||(h=f.dftbool),h===q.bool&&m===(q.not||!1)?q.subs.push(a):q={bool:h,subs:[q,a]}):q=a;h=!1};b<k;)if('"'==a[b]){g=b++;for(l="";b<k&&'"'!=a[b];)l+=a[b++];if(b>=k)return{error:"unbalanced quotes",pos:g+c};r({text:l});b++}else{if(")"==a[b])return{error:"unbalanced parenthesis",pos:g+c};if("("==a[b]){g=b++;n=1;for(l="";b<k&&(")"!=a[b]||0!=--n);){"("==a[b]&&n++;l+=a[b];if('"'==a[b]){for(p=b++;b<k&&'"'!=a[b];)l+=a[b++];l+=a[b];if(b>=
k)return{error:"unbalanced quotes",pos:p+c}}b++}if(b>=k)return{error:"unbalanced parenthesis",pos:g+c};p=e(l,g+1,f);if(p.error)return p;r(p,l);b++}else if(" ">=a[b])for(;b<k&&" ">=a[b];)b++;else if("+"==a[b]){if(m||h)return{error:"unexpected operator",pos:b+c};h="AND";s=b++}else if("|"==a[b]){if(m||h)return{error:"unexpected operator",pos:b+c};h="OR";s=b++}else if("-"==a[b]||"!"==a[b])m=!m,s=b++;else{g=b;for(l="";b<k&&" "<a[b]&&!/[\(\)\+\-\|\!]/.test(a[b]);)l+=a[b++];if(/^(AND|OR|NOT|NEAR\d)$/i.test(l))if(s=
g,p=RegExp.$1.toUpperCase(),"NOT"==p)m=!m;else{if(m||h)return{error:"unexpected operator",pos:g+c};h=p}else r({text:l})}}return m||h?{error:"unexpected operator",pos:s+c}:q?q:{error:"empty query",pos:c}};this.error=this.tree=!1;this.query=this.opts.unaccent?t(a):a;a=e(this.query,0,this.opts);delete this.pos;a.error?(this.error=a.error,this.pos=a.pos,this.opts.debug&&console.log(a.error,"at",a.pos)):(this.tree=a,this.opts.debug&&console.log(this.dump()));return this},dump:function(a,e){if(!this.tree)return"";
a||(a=this.tree);e||(e="");var d=a.not?"NOT ":"",c=a.src?" : "+d+"("+a.src+")":"",f=void 0!=a.match?" = "+a.match:"";self=this;return a.bool?e+d+a.bool+f+c+"\n"+a.subs.map(function(a){return self.dump(a,e+" | ")}).join("\n"):e+d+'"'+a.text+'"'+f},normalize:function(a){a||(a=this.tree);if(!a)return"";var e=a.not?"NOT ":"",d=[],c=this;return a.bool?(a.subs.forEach(function(a){d.push(c.normalize(a))}),e||a!=this.tree?e+"("+d.join(" "+a.bool+" ")+")":d.join(" "+a.bool+" ")):/^(and|or|not)$/i.test(a.text)||
/[\s\(\)\+\-\!\?\|]/.test(a.text)?e+'"'+a.text+'"':e+a.text},match:function(a){if(!this.tree)return!1;var e=this,d=function(a){delete a.match;a.bool&&a.subs.forEach(function(a){d(a)})},c=function(a,f,h){var k,g,d,n;if(a.bool)if("AND"==a.bool)for(k=!0,g=0;g<a.subs.length&&k;++g)k=c(a.subs[g],f,h);else for(k=!1,g=0;g<a.subs.length&&(!(k=c(a.subs[g],f,h)||k)||h);++g);else if(!1===h||a.not)k=a.rex.test(f);else for(k=!1;null!=(g=a.rex.exec(f));)k=!0,d=g[0],g=g.index,e.opts.sensitive||(d=d.toLowerCase()),
e.opts.wholeword&&(n=d.length,d=d.replace(/^\W+/g,""),g+=n-d.length,d=d.replace(/\W+$/g,"")),void 0==h[d]&&(h[d]=[]),h[d].push(g);a.not&&(k=!k);return a.match=k},f=this.opts.matches?{}:!1;d(this.tree);a=c(this.tree,this.opts.unaccent?t(a):a,f);this.opts.debug&&(console.log(this.dump()),f&&console.log(f));return this.opts.matches&&a?f:a},highlightml:function(a,e,d){if(!this.tree)return a;if(!this.opts.matches)return!1;var c=a.innerHTML,f="",b,m;b=0;for(m=!1;b<c.length;++b)m||(m="<"==c[b]),m?(m=">"!=
c[b],f+=" "):f+=c[b];a.innerHTML=u(this.match(f),c,e,d);return a},highlight:function(a,e,d,c){return"object"==typeof a?this.highlightml(a,e,d):c?(c=document.createElement("div"),c.innerHTML=a,this.highlightml(c,e,d).innerHTML):this.tree?this.opts.matches?u(this.match(a),a,e,d):!1:a}};n&&("string"==typeof n?r.parse(n):"object"==typeof n&&(["debug","sensitive","wholeword","unaccent","matches"].forEach(function(a){void 0!==n[a]&&(r.opts[a]=n[a])}),n.query&&r.parse(n.query)));return r};