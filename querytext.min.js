var querytext=function(m){var t=function(a){return a.replace(/\u00c6/gm,"AE").replace(/[\u00c1\u00c2\u00c0\u00c5\u00c3\u00c4]/gm,"A").replace(/\u00c7/gm,"C").replace(/[\u00c9\u00ca\u00c8\u00cb]/gm,"E").replace(/[\u00cd\u00ce\u00cc\u00cf]/gm,"I").replace(/\u00d1/gm,"N").replace(/\u0152/gm,"OE").replace(/[\u00d3\u00d4\u00d2\u00d8\u00d5\u00d6]/gm,"O").replace(/[\u00da\u00db\u00d9\u00dc]/gm,"U").replace(/\u00dd/gm,"Y").replace(/\u00e6/gm,"ae").replace(/[\u00e1\u00e2\u00e0\u00e5\u00e3\u00e4]/gm,"a").replace(/\u00e7/gm,"c").replace(/[\u00e9\u00ea\u00e8\u00eb]/gm,"e").replace(/[\u00ed\u00ee\u00ec\u00ef]/gm,"i").replace(/\u00f1/gm,"n").replace(/\u0153/gm,"oe").replace(/[\u00f3\u00f4\u00f2\u00f8\u00f5\u00f6]/gm,"o").replace(/[\u00fa\u00fb\u00f9\u00fc]/gm,"u").replace(/[\u00fd\u00ff]/gm,"y")},u=function(a,f,e,c){var d,b=[],g={};for(d in a)a[d].forEach(function(b){if(!g[b]||g[b][1]<d.length)g[b]=[b,d.length]});for(d in g)b.push(g[d]);b.sort(function(b,a){return a[0]-b[0]}).forEach(function(b){f=f.substr(0,b[0])+e+f.substr(b[0],
b[1])+c+f.substr(b[0]+b[1])});return f},r={VERSION:0.5,opts:{dftbool:"OR",sensitive:!1,wholeword:!0,unaccent:!0,matches:!1,debug:!1},error:!1,query:!1,tree:!1,parse:function(a){var f=function(a,c,d){c||(c=0);for(var b=0,g=!1,n=!1,k=a.length,h,s,p,l,m,q,r=function(a,b){g&&(a.not=!0,n||(n="AND"),g=!1);if(a.text){var c=a.text.replace(/(^\s+|\s+$)/gm,""),f="*"!=c[0]&&d.wholeword?"(^|\\W:?)":"",h="*"!=c.substr(-1)&&d.wholeword?"($|\\W:?)":"",c=c.replace(/(^\*|\*$)/g,""),c=c.replace(/([\(\)\+\*\?\:\[\]])/g,
"\\$1"),c=c.replace(/\s+/g,"\\s+");a.rex=RegExp(f+c+h,"m"+(d.sensitive?"":"i")+(d.matches?"g":""))}b&&(a.src=b);q?(n||(n=d.dftbool),n===q.bool&&g===(q.not||!1)?q.subs.push(a):q={bool:n,subs:[q,a]}):q=a;n=!1};b<k;)if('"'==a[b]){h=b++;for(l="";b<k&&'"'!=a[b];)l+=a[b++];if(b>=k)return{error:"unbalanced quotes",pos:h+c};r({text:l});b++}else{if(")"==a[b])return{error:"unbalanced parenthesis",pos:h+c};if("("==a[b]){h=b++;m=1;for(l="";b<k&&(")"!=a[b]||0!=--m);){"("==a[b]&&m++;l+=a[b];if('"'==a[b]){for(p=
b++;b<k&&'"'!=a[b];)l+=a[b++];l+=a[b];if(b>=k)return{error:"unbalanced quotes",pos:p+c}}b++}if(b>=k)return{error:"unbalanced parenthesis",pos:h+c};p=f(l,h+1,d);if(p.error)return p;r(p,l);b++}else if(" ">=a[b])for(;b<k&&" ">=a[b];)b++;else if("+"==a[b]){if(g||n)return{error:"unexpected operator",pos:b+c};n="AND";s=b++}else if("|"==a[b]){if(g||n)return{error:"unexpected operator",pos:b+c};n="OR";s=b++}else if("-"==a[b]||"!"==a[b])g=!g,s=b++;else{h=b;for(l="";b<k&&" "<a[b]&&!/[\(\)\+\-\|\!]/.test(a[b]);)l+=
a[b++];if(/^(AND|OR|NOT|NEAR\d)$/i.test(l))if(s=h,p=RegExp.$1.toUpperCase(),"NOT"==p)g=!g;else{if(g||n)return{error:"unexpected operator",pos:h+c};n=p}else r({text:l})}}return g||n?{error:"unexpected operator",pos:s+c}:q?q:{error:"empty query",pos:c}};this.error=this.tree=!1;this.query=this.opts.unaccent?t(a):a;a=f(this.query,0,this.opts);delete this.pos;a.error?(this.error=a.error,this.pos=a.pos,this.opts.debug&&console.log(a.error,"at",a.pos)):(this.tree=a,this.opts.debug&&console.log(this.dump()));
return this},dump:function(a,f){if(!this.tree)return"";a||(a=this.tree);f||(f="");var e=a.not?"NOT ":"",c=a.src?" : "+e+"("+a.src+")":"",d=void 0!=a.match?" = "+a.match:"";self=this;return a.bool?f+e+a.bool+d+c+"\n"+a.subs.map(function(a){return self.dump(a,f+" | ")}).join("\n"):f+e+'"'+a.text+'"'+d},normalize:function(a){a||(a=this.tree);if(!a)return"";var f=a.not?"NOT ":"",e=[],c=this;return a.bool?(a.subs.forEach(function(a){e.push(c.normalize(a))}),f||a!=this.tree?f+"("+e.join(" "+a.bool+" ")+
")":e.join(" "+a.bool+" ")):/^(and|or|not)$/i.test(a.text)||/[\s\(\)\+\-\!\?\|]/.test(a.text)?f+'"'+a.text+'"':f+a.text},match:function(a){if(!this.tree)return!1;var f=this,e=function(a){delete a.match;a.bool&&a.subs.forEach(function(a){e(a)})},c=function(a,g,d){var k,h,e,m;if(a.bool)if("AND"==a.bool)for(k=!0,h=0;h<a.subs.length&&k;++h)k=c(a.subs[h],g,d);else for(k=!1,h=0;h<a.subs.length&&(!(k=c(a.subs[h],g,d)||k)||d);++h);else if(!1===d||a.not)k=a.rex.test(g);else for(k=!1;null!=(h=a.rex.exec(g));)k=
!0,e=h[0],h=h.index,f.opts.sensitive||(e=e.toLowerCase()),f.opts.wholeword&&(m=e.length,e=e.replace(/^\W+/g,""),h+=m-e.length,e=e.replace(/\W+$/g,"")),void 0==d[e]&&(d[e]=[]),d[e].push(h);a.not&&(k=!k);return a.match=k},d=this.opts.matches?{}:!1;e(this.tree);a=c(this.tree,this.opts.unaccent?t(a):a,d);this.opts.debug&&(console.log(this.dump()),d&&console.log(d));return this.opts.matches&&a?d:a},highlightml:function(a,f,e){if(!this.tree)return a;if(!this.opts.matches)return!1;var c=a.innerHTML,d="",
b,g;b=0;for(g=!1;b<c.length;++b)g||(g="<"==c[b]),g?(g=">"!=c[b],d+=" "):d+=c[b];a.innerHTML=u(this.match(d),c,f,e);return a},highlight:function(a,f,e,c){return"object"==typeof a?this.highlightml(a,f,e):c?(c=document.createElement("div"),c.innerHTML=a,this.highlightml(c,f,e).innerHTML):this.tree?this.opts.matches?u(this.match(a),a,f,e):!1:a}};m&&("string"==typeof m?r.parse(m):"object"==typeof m&&(["debug","sensitive","wholeword","unaccent","matches"].forEach(function(a){void 0!==m[a]&&(r.opts[a]=m[a])}),
m.query&&r.parse(m.query)));return r};